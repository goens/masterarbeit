%%blah blah de entrada...
%% \begin{theorem}

%% Let $k$ be a $\s$-field and $a$ 
%% \end{theorem}
In this section we will see a further approach to investigating difference ideals. We will take a look at the properties a difference ideal has by looking at its intersection with the variables up to a finite power of sigma.

\begin{defn}
Let $k$ be a difference field and $d \in \N$. Then we define $k\{y\}[d]:= k[y,\s(y),\ldots,\s^d(y)]$ and we set $k\{y\}[-1] := k$. Let $\a \si k\{y\}$ be a difference ideal in the full $\s$-polynomial ring $k\{y\}$. 
We set $\a[d] := \a \cap k\{y\}[d]$.
\end{defn}


\begin{defn}
Let $\a \unlhd k\{y\}[d], d \geq 1$ be an ideal of $k\{y\}[d]$. Then $\a$ is called a \emph{difference kernel of length $d$}, if $\s(\a[d-1]) \subseteq \p$. The difference kernel is called \emph{prime}, if additionally $\a$ is a prime ideal of $k\{y\}[d]$.
Finally, $\a$ is called a \emph{reflexive difference kernel of length $d$} if $\s^{-1}(\a) = \a[d-1]$. \index{difference kernel} \index{prime difference kernel} \index{reflexive difference kernel}
\end{defn}\index{difference kernels}

It is worth noting that this notation differs from that of the standard literature (in particular \cite{cohn} and \cite{levin}). In the standard literature, the quotient ring obtained by factoring out 
what we here defined as a prime, reflexive kernel is called a kernel, and the rest of the concepts are not treated. We chose to change the notation here to be able to study other $\s$-ideals with this methodology.

\begin{rem}
It is easy to see that a reflexive kernel is always a kernel, but the converse is not necesarilly true: $\a$ being a kernel of length $d$ only guarantees the inclusion $\a[d-1] \subseteq \s^{-1}(\a)$.
\end{rem}

\begin{ex}
Let $\p \si k\{y\}$ be a prime $\s$-ideal, $d \geq 1$. Then $\p[d] \unlhd k\{y\}[d]$ is a prime kernel: since $\p$ is a $\s$-ideal we have $\s(\p[d-1]) \subseteq \p$, 
and since $\p$ is prime we know that $\p[d]$ has to be prime as well. If $\p$ is also reflexive (i.e. a $\s$-prime ideal), then $\p[d]$ is a reflexive, prime kernel. 
\end{ex}

Inspired by the former example we define the following:
\begin{defn}
Let $\a \unlhd k\{y\}[d]$ be a kernel of length $d$, and $\a' \si k\{y\}$ be a $\s$-ideal. Then we call $\a'$ a realization of $\a$, if $\a \subseteq \a'$, 
and we call the realization regular if it also holds that $\a'[d] = \a$. Similarly, if $\a$ is a reflexive/prime kernel, then we define a realization to be a reflexive/prime realization if the $\s$-ideal $\a'$ is reflexive/prime.
\end{defn}\index{(regular) realization}

The former example and the acompanying definition are actually much more general than it would seem to be at first. 
It is in fact the case that prime,reflexive kernels are always of the form $\p[d]$ for a $\s$-prime ideal $\p$.
For prime kernels which are not reflexive in general it is not that simple, as we will also see later. 

\begin{rem}\label{sigmawelldeffker}
Let $\p \subseteq k\{y\}$ be a difference kernel of length $d$. Then, $\s$ induces a well-defined mapping 
\begin{align*}
\s: k[y,\ldots,\s^{d-1}(y)]/\p[d-1] \rightarrow k[y,\ldots,\s^{d}(y)]/\p
\end{align*}
If $\p$ is a reflexive kernel, then this mapping is injective. 
We set $a := \bar y = y + \p \in k\{y\}[d]/\p$. If $\p$ is a prime, reflexive kernel, then we can extend $\s$ to the quotient fields:
\[ \s: k(a,\ldots,\s^{d-1}(a)) \cong \text{Quot}(k[y,\ldots,\s^{d-1}(y)]/\p[d-1]) \rightarrow k(a,\ldots,\s^d(a)) = k(\p) \]
\end{rem}

Even in the case of prime difference kernels we can work with the properties of field extensions, though we cannot properly extend $\s$ to the fields.
 In particular, we get a nice way of defining some sort of ``difference degree'' of prime kernels:
\begin{defn}
Let $\p \subseteq k\{y\}$ be a prime difference kernel of length $d$, and let $a:= y + \p \in k(p)$; we define the difference dimension of $\p$ as follows:
\begin{align*} \sdim(\p) := \trdeg(k(\p)/k(\p[d-1]) = \trdeg((k\{y\}[d]/\p)/(k\{y\}[d-1]/\p[d-1])) \\  = \trdeg(k(a,\ldots,\s^{d}(a))/k(a,\ldots,\s^{d-1}(a))) \end{align*}
\end{defn}\index{$\s$-dimension of a $\s$-kernel}

If we want to show that prime, reflexive difference kernels are the intersection of $\s$-prime ideals with $k\{y\}[d]$, and similar cases for other types of kernels,
it is reasonable to consider some sort of extension, or \emph{prolongation} of a kernel, which would be the intesrection with $k\{y\}[d+1]$.  \index{prolongation (of a difference kernel)}
This motivates the following definition: 

\begin{defn}
Let $\a \subseteq k\{y\}$ be a difference kernel of length $d$, and $\a' \supset \a$ be a further difference kernel, of length $d+1$.
Then we call $\a'$ a \emph{prolongation} of $\a$, if $\a'[d] = \a$. Similarly, for a prime/reflexive kernel we say the prolongation is prime/reflexive if, $\a'$ is also prime/reflexive.
For a prime prolongation, if it holds further that $\sdim(\a) = \sdim(a')$, then we call the prolongation \emph{generic}.
\end{defn}\index{generic prolongation}

\begin{defn}
Let $\p \subseteq k\{y\}$ be a prime difference kernel of length $d$, and let $\p'$ be a realization of $\p$. We call $\p'$ a \emph{principal realization} of $\p$, if $\p'[i+1]$ is a generic prolongation of $\p'[i]$ for all $i \geq d$,
and we say the realization is \emph{reflexive} if the prolongations are reflexive. \index{principal realization} \index{reflexive realization}
\end{defn}

As mentioned above, the case for reflexive, prime kernels is well understood. It can be summarized by the following Theorem, which can be found as Corollary 5.2.8 of \cite{wibmer}:
\begin{theorem}
Let $\q \subseteq k\{y\}$ be a prime, reflexive kernel of length $d$. Then there exists a reflexive, principal realization of $\q$. 
\end{theorem}

The case is unfortunately not as simple in the case of prime kernels that are not necessarily reflexive, as shown by the following example.

\begin{ex}\label{counterexker}
Consider the difference polynomials $f_1 := \s(y_2) + 1, f_2:= \s(y_1)y_2 + y_1y_2 + \s(y_1) + y_1 + y_2 \in k[y_1,y_2,\s(y_1),\s(y_2)] =: R$.
A calculation with \cite{M2} quickly identifies that the ideal $(f_1,f_2) \unlhd R$ is prime, and in fact, $f_1,f_2$ is a Gr\"{o}bner Basis of $(f_1,f_2)$ with respect to the
term ordering $y_1 < y_2 < \s(y_1) < \s(y_2)$. This means in particular, that $(f_1,f_2)[0] = \{0\}$, and thus $(f_1,f_2)$ is a prime kernel of length $1$ of $k\{y_1,y_2\}$. However,
\[ f_1 \cdot (\s^2(y_1) + \s(y_1) + 1 ) - \s(f_2) = 1 \]
Which means that any $\s$-ideal of $k\{y_1,y_2\}$ containing $f_1, f_2$ is already the whole ring, and is not prime, by definition.
\end{ex}

As the example shows, prime kernels are not always the intersection of a prime difference ideal with $k\{y\}[d]$. 
If we want to try and classify those prime kernels that are in fact such intersections, we can try and find necessary conditions to be able to find a prolongation of a kernel. 
We will develop a condition that is necessary but not sufficient. First, however, we need a Lemma to help prove this.

\begin{lem}\label{primeoverp1}
Let R be an integral domain and $I \unlhd R[y]$ be an ideal of $R[y] = R[y_1,\ldots,y_n]$ which satisfies that $I \cap R = \{ 0 \}$.
Then there exists a prime ideal $P$ with $I \subseteq P \subseteq R[y] $ such that $P \cap R = \{0\}$.
\begin{proof}
We can assume without loss of generality that I is radical:
Namely, if $f \in \sqrt{I} \cap R$, then there exists an $m \in \N$ such that $f^m \in I \cap R = \{0\}$, and since $R$ is an integral domain this already means that $f = 0$.
We then note that for two sets $A,B \subseteq R[y]$ it holds that $\sqrt{A}\sqrt{B} \subseteq \sqrt{AB}$: Consider $f \in \sqrt{A}, g \in \sqrt{B}$. Then there exist $m, \tilde m \in \N$ such that $f^m \in (A), g^{\tilde m} \in (B)$;
 assume without loss of generality that $m > \tilde m$, then $(fg)^m \in (A)(B)$, which implies $fg \in \sqrt{(A)(B)} = \sqrt{AB}$.
Now, for the proof, consider the set of all radical ideals $J$ contaning $I$ which satisify $J \cap R = \{0\}$. This set is not empty and is inductively ordered by inclusion.
By Zorn's lemma this means that there is a maximal element $P$ of this set. This ideal $P$ is prime, then: assume there exist $f,g \notin P$ with $fg \in P$. 
Then the radical ideals $\sqrt{P \cup \{f\}}$, $\sqrt{P \cup \{f\}}$ strictly include $P$, and by the maximality of $P$ it means there exist $t_1, t_2 \in R\backslash\{0\}$ such that
$t_1 \in \sqrt{P \cup \{f\}}$, $t_2 \in \sqrt{P \cup \{g\}}$. But in particular, because $R$ is free of zero divisors, this implies that
 \[0 \neq t_1t_2 \in \sqrt{P \cup \{f\}}\sqrt{P \cup \{g\}} \subseteq \sqrt{ \underbrace{(P \cup \{f\})(P \cup \{g\})}_{=P\text{, since }fg \in P}} = P\]
A contradiction.
\end{proof}
\end{lem}


%% \begin{lem}\label{idealstill0}
%% Let $R \subseteq S$ be two rings, and let $I \unlhd R[y]$ be an ideal in the polynomial ring $R[y]$ with $I \cap R = 0$. 
%% Then it holds for the ideal $(I) \unlhd S[y]$, that $(I) \cap S = 0$.
%% \begin{proof}
%% Since $S$ is an $R$ module, we know that $S \cong R \otimes_R S$, from which it easily follows that $S[y] \cong R[y] \otimes_R S$, and similarly, that $I \otimes_R S \cong (I) \unlhd S[y]$.
%% Together, these two imply that as well $R[y]/I \otimes_R S \cong S[y]/(I)$. FIXME: check this!
%% The condition $R \cap I = 0$ is equivalent to the mapping $R \rightarrow R[y]/I, r \mapsto r + I$ being injective. We can express this as the exactness of the following sequence:
%% \[ 0 \rightarrow R \rightarrow R[y]/I \]
%% Since the tensor product functor is exact, we know that tensoring over $R$ with $S$ yields an exact sequence:
%% \[ 0 \rightarrow R \otimes_R S \cong S \rightarrow R[y]/I \otimes_R S \cong S[y]/(I) \]
%% This, in turn, is equivalent to $S \cap (I) = 0$ by going the arguments above backwards.

%% \end{proof}
%% \end{lem}

 
\begin{prop}
Let $\a \subseteq k[y,\ldots,\s^d(y)]$ be a prime difference kernel of length $d$ and let $k[y,\ldots,\s^d(y)]/\a =: k[a,\s(a),\ldots,\s^d(a)]$. Consider the mapping 
\[ \s: k[a,\ldots,\s^{d-1}(a)] \rightarrow k[a,\ldots,\s^d(a)]. \]
Assume that for $(\operatorname{ker}(\s)) \subseteq k[a,\ldots,\s^d(a)]$ it holds that $(\operatorname{ker}(\s)) \cap k[a,\ldots,\s^{d-1}(a)] = \operatorname{ker}(\s)$. 
Then there exists a prime difference kernel $\tilde \a \subseteq k[y,\ldots,\s^{d+1}(y)]$ of length $d+1$ with $\tilde \a \cap k[y,\ldots,\s^d(y)] = \a$
\begin{bew}
Consider the surjective mapping 
\[ k[a,\ldots,\s^{d-1}(a)][\s^d(y)] \rightarrow k[a,\ldots,\s^d(a)], \s^d(y) \mapsto \s^d(a) \]
Let $\p_1$ be the kernel of this mapping. Since $k[a,\ldots,\s^d(a)]$ is a domain, we know by the fundamental theorem on homomorphisms that $\p_1$ has to be prime. 
First, we will show that our assumption on $\operatorname{ker}(\s)$ is equivalent to:
\begin{equation}\label{skercapsk} \s(\p_1) \cap \s(k)[\s(a),\ldots,\s^d(a)] = 0 \end{equation}
To see this consider the following commutative diagram:
\[
\begin{xy}
 \xymatrix{
      k[a,\ldots,\s^{d-1}(a)][\s^d(y)] \ar[rr]^\s \ar@{->>}[rd]^\s  &     &  k[a,\ldots,\s^d(a)][\s^{d+1}(y)]   \\
      &  \s(k)[\s(a),\ldots,\s^d(a)][\s^{d+1}(y)] \ar@^{(->}[ur] &  }
\end{xy}
\]

We can factor out $\p_1$ and its image, $\s(\p_1)$. Since $k[a,\ldots,\s^{d-1}(a)][\s^d(y)] / \p_1 \cong k[a,\ldots, \s^d(a)]$,
we get a surjectve mapping $k[a,\ldots, \s^d(a)] \twoheadrightarrow \s(k)[\s(a),\ldots,\s^d(a)][\s^{d+1}(y)]/\s(\p_1)$.
If we factor out the kernel, we get an isomorphism:
\[ k[a,\ldots, \s^d(a)]/(\operatorname{ker}(\s)) \cong \s(k)[\s(a),\ldots,\s^d(a)][\s^{d+1}(y)]/\s(\p_1)\]
On the other hand, we have the canonical embedding $k[a,\ldots,\s^{d-1}(a)] \hookrightarrow k[a,\ldots,\s^{d}(a)]$.
This mapping stays injective after factoring out the kernel of $\s$ on both sides, 
i.e. $k[a,\ldots,\s^{d-1}(a)]/\operatorname{ker}(\s) \hookrightarrow k[a,\ldots,\s^{d}(a)]/(\operatorname{ker}(\s))$ is injective, if and only if our assumption on $\ker(\s)$ holds.
In this case, by composition with the isomorphism above, we get an embedding:
\[ k[a,\ldots,\s^{d-1}(a)]/\operatorname{ker}(\s) \hookrightarrow \s(k)[\s(a),\ldots,\s^d(a)][\s^{d+1}(y)]/\s(\p_1) \]
This is injective if and only if Equation \ref{skercapsk} holds.
%Now, by Lemma \ref{idealstill0} 
Equation \ref{skercapsk} implies \textcolor{red}{(WHY??)} that
\begin{equation}\label{skercapk}
(\s(\p_1)) \cap k[a,\s(a),\ldots,\s^d(a)][\s^{d+1}(y)] = 0
\end{equation}
We will now construct a prime difference kernel $\tilde \a$ using Equation \ref{skercapsk}:

By Lemma \ref{primeoverp1} there exists a minimal prime ideal $\p_2 \supset (\s(\p_1))$ of $k[a,\ldots,\s^d(a)][\s^{d+1}(y)]$ containing $\s(p_1)$ with $\p_2 \cap k[a,\ldots,\s^d(a)] = \{0\}$. 
We thus get a well-defined maping
\[ \s: k[a,\ldots,\s^{d-1}(a)][\s^d(y)]/\p_1 \rightarrow k[a,\ldots, \s^d(a)][\s^{d+1}(y)]/\p_2 \]
We define $R_2:= k[a,\ldots,\s^d(a)][\s^{d+1}(y)]/\p_2 =: k[a,\ldots,\s^d(a),\s^{d+1}(a)]$, which is an integer domain since $\p_2$ is prime. Since $\p_2 \cap k[a,\ldots,\s^d(a)] = 0$ we can use this notation unambiguosly:
this guarantees namely that for $a, \ldots, \s^d(a)$ we have the same residue classes modulo $\p_2$ as we had modulo $\a$.
The kernel $\tilde \a$ of the natural epimorphism $k[y,\ldots,\s^{d+1}(y)] \rightarrow R_2$ is thus a prime ideal.
Further we have $\a \subseteq \tilde \a$ by construction (as $\a = 0 \subset R_2$). In fact, it holds that $\tilde \a[d] = \p$ since: 
\begin{align*}
\tilde \a[d] = \{ f \in k[y,\ldots,\s^d(y)] \mid f(a) = 0 \} = \ker( k\{y\}[d] \rightarrow k[a,\ldots,\s^{d}(a)]) = \a
\end{align*}
where the first equality uses the fact that $\p_2 \cap k[a,\ldots,\s^d(a)] = 0$, as noted by the use of the notation explained above, and last equality holds by definition of $a \in k[a,\ldots,\s^d(a)]$. This means, that $\tilde \a$ is a prolongation of $\a$. 
\end{bew}
\end{prop}

The condition $(\operatorname{ker}(\s)) \cap k[a,\ldots,\s^{d-1}(a)] = \operatorname{ker}(\s)$ is thus necessary for finding principal realizations of prime kernels. 
That this the case is not surprising once you consider the case for reflexive prime kernels, since the triviality of $\operatorname{ker}(\s)$ is implied by the prime difference kernel being reflexive.


\begin{ex}
Let $k$ be a $\s$-field and consider the $\s$-polynomial ring $k\{y_1,y_2\}$. 
The ideal $$\a = (\s^2(y_2)+1,\s^2(y_1)y_2 + \s(y_1)y_2 + \s^2(y_1) + \s(y_1) + y_2) \unlhd k\{y_1,y_2\}[2]$$ is a prime kernel,
as can be verified by a calculation using \cite{M2}, for which it holds that if we consider the factor ring 
$k\{y\}[2]/\a =: k\{a,\s(a),\s^2(a)\}$, the kernel of $\s: k\{a,\s(a)\} \rightarrow k\{a,\s(a),\s^2(a)\}$
satisfies that $$(ker(\s)) \cap k\{a,\s(a)\} = ker(\s).$$ However, similarly to the case in Example \ref{counterexker}, any difference ideal of $k\{y\}$ containing 
$\a$ has to contain $1$ and thus be already the whole ring $k\{y\}$.
\end{ex}

We see then, that the condition $(\operatorname{ker}(\s)) \cap k[a,\ldots,\s^{d-1}(a)] = \operatorname{ker}(\s)$, while sufficient for finding a single generic prolongation,
is not sufficient for finding a principal realization. This motivates the following conjecture:

\begin{conj}
Let $k$ be a $\s$-field and $\a \subseteq k\{y\}[d]$ a prime $\s$-kernel of length $d$.
And let $k\{y\}[d]/\a \cong k\{a\}$, i.e., let $a_1 = y_1 + \a ,\ldots,a_n = y_n + \a$.
For $r \geq 1$ consider the mapping 
\[ \s^r : k[a,\s(a),\ldots,s^{d-r}(a)] \rightarrow k[a,\ldots,\s^{d}], f \mapsto \s^r(f) \]
Assume that
\begin{equation}\label{conditionkernels} (\operatorname{ker}(\s),\ldots,\operatorname{ker}(\s^r)) \cap k[a,\ldots,\s^{d-r}(a)] = \operatorname{ker}(\s^r) \end{equation}
Then there exists a principal realization of $\a$.
\end{conj}

Since in $k\{y\}$ it holds that $\operatorname{ker}(\s^r) \subseteq \operatorname{ker}(\s^{r+1})$, this condition,
Equation \ref{conditionkernels}, is a necessary condition for the existence of a principal realization. 



        %% @Misc{M2,
        %%   author = {Grayson, Daniel R. and Stillman, Michael E.},
        %%   title = {Macaulay2, a software system for research 
        %%            in algebraic geometry},
        %%   howpublished = {Available at 
        %%       \href{http://www.math.uiuc.edu/Macaulay2/}%
        %%            {http://www.math.uiuc.edu/Macaulay2/}}
        %% }

